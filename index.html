<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„å¤¢å¹»ä»»å‹™åŸå¸‚ ğŸ˜ï¸</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --main-blue: #a1c4fd; --grass-green: #7ed6df; }
        body { font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; background: #f0f2f5; margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        /* åŸå¸‚é¢¨æ™¯å€ */
        #city-view {
            width: 100%; height: 250px; 
            background: linear-gradient(to bottom, #a1c4fd 0%, #c2e9fb 100%);
            position: relative; display: flex; align-items: flex-end; justify-content: center;
            border-bottom: 8px solid var(--grass-green); overflow-x: auto;
        }
        .building { font-size: 50px; animation: bounceIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); margin: 0 5px; }
        @keyframes bounceIn { from { transform: scale(0); } to { transform: scale(1); } }

        /* æ§åˆ¶å° */
        .panel { width: 90%; max-width: 500px; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-top: -30px; z-index: 10; }
        h2 { color: #5758bb; text-align: center; }
        input, button { width: 100%; padding: 12px; margin: 5px 0; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; }
        button { background: #6c5ce7; color: white; border: none; font-weight: bold; cursor: pointer; }
        
        /* ä»»å‹™æ¸…å–® */
        ul { list-style: none; padding: 0; }
        .task-card { background: #f9f9f9; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #6c5ce7; }
        .done-btn { width: auto; background: #55efc4; padding: 5px 15px; }
    </style>
</head>
<body>

<div id="city-view"></div>

<div class="panel">
    <h2>ğŸ—ï¸ åŸå¸‚å»ºç¯‰å¸«æ§åˆ¶å°</h2>
    <input type="text" id="tInput" placeholder="æƒ³å®Œæˆä»€éº¼ä»»å‹™ï¼Ÿ">
    <button onclick="addTask()">ç™¼å¸ƒå»ºç¯‰æŒ‡ä»¤</button>
    
    <h3>ğŸ“Œ é€²è¡Œä¸­çš„å·¥åœ°</h3>
    <ul id="taskList"></ul>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

 // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBbKZWbc7sJT2OaSs_GG7xw15l9ljMzzMc",
  authDomain: "mybloomcity.firebaseapp.com",
  projectId: "mybloomcity",
  storageBucket: "mybloomcity.firebasestorage.app",
  messagingSenderId: "612870866616",
  appId: "1:612870866616:web:4110f2ae283078940dd64d",
  measurementId: "G-EEXNXD2T18"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const taskCol = collection(db, "myTasks");

    // ç›£è½é›²ç«¯ï¼Œéš¨æ™‚æ›´æ–°åŸå¸‚
    onSnapshot(taskCol, (snap) => {
        const tasks = [];
        snap.forEach(d => tasks.push({ id: d.id, ...d.data() }));
        drawCity(tasks);
    });

    // æŠŠä»»å‹™å‚³ä¸Šé›²ç«¯
    window.addTask = async () => {
        const title = document.getElementById('tInput').value;
        if (!title) return;
        await addDoc(taskCol, { title, done: false });
        document.getElementById('tInput').value = '';
    };

    // å®Œæˆä»»å‹™ = è“‹å¥½æˆ¿å­
    window.finish = async (id) => {
        await updateDoc(doc(db, "myTasks", id), { done: true });
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    };

    function drawCity(tasks) {
        const listEl = document.getElementById('taskList');
        const cityEl = document.getElementById('city-view');
        listEl.innerHTML = '';
        cityEl.innerHTML = '';

        const houses = ["ğŸ ", "ğŸ¡", "ğŸ¢", "ğŸ¬", "ğŸ«", "ğŸª", "ğŸ°", "ğŸ¡", "â›²", "ğŸŒ³"];
        let count = 0;

        tasks.forEach(t => {
            if (!t.done) {
                listEl.innerHTML += `<li class="task-card"><span>${t.title}</span><button class="done-btn" onclick="finish('${t.id}')">å®Œå·¥!</button></li>`;
            } else {
                const span = document.createElement('span');
                span.className = 'building';
                span.innerText = houses[count % houses.length];
                cityEl.appendChild(span);
                count++;
            }
        });
    }
</script>
</body>
</html>